nsapp = NSApplication sharedApplication

\ Create the menubar
menuBar     = NSMenu new
appMenuItem = NSMenuItem new
menuBar addItem: appMenuItem
nsapp setMainMenu: menuBar

\ Add the Application menu & the quit item
quitMenuItem = NSMenuItem alloc initWithTitle: "Quit #{NSProcessInfo processInfo processName}"
                                       action: "terminate:"
                                keyEquivalent: "q"
appMenu = NSMenu new;
             addItem: quitMenuItem;
                self

appMenuItem setSubmenu: appMenu

\ Create a window
win = NSWindow alloc initWithContentRect: [NSZeroPoint, [300, 200]]
                               styleMask: (NSTitledWindowMask bitOr: NSResizableWindowMask)
                                 backing: NSBackingStoreBuffered
                                   defer: no;
                                setTitle: "Tranquil!";
                    makeKeyAndOrderFront: nil;
                                    self

\ Create a little view
#TestView < NSView {
    - init {
        super init
        #gradient = NSGradient alloc initWithStartingColor: NSColor redColor
                                               endingColor: NSColor yellowColor
        ^self
    }
    - drawRect: dirtyRect {
        NSColor cyanColor set
        #gradient drawInRect: dirtyRect angle: 45
    }
}

view = TestView new; setFrame: (win contentView bounds); self
win#contentView = view

\ Start the app
nsapp setActivationPolicy: NSApplicationActivationPolicyRegular
nsapp activateIgnoringOtherApps: yes
nsapp run
